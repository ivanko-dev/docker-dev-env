services:
  # PLEASE UNCOMMENT THIS IF YOU WANT TO USE PHP 8.1
  # php81:
  #   image: ivankodev/php:8.1
  #   # build: ./images/php/8.1
  #   volumes:
  #     - ./www/:/var/www/
  #     - ~/.ssh/:/var/www/.ssh/
  #   hostname: php81.ivanko.docker
  #   container_name: php81
  #   extra_hosts:
  #     - host.docker.internal:host-gateway
  #   restart: unless-stopped
  #   environment:
  #     - XDEBUG=on
  #     - PHP_IDE_CONFIG=serverName=Docker
  #     - COMPOSER_VERSION=2
  #   networks:
  #     - net

  # PLEASE UNCOMMENT THIS IF YOU WANT TO USE PHP 8.2
  # php82:
  #   image: ivankodev/php:8.2
  #   # build: ./images/php/8.2
  #   volumes:
  #     - ./www/:/var/www/
  #     - ~/.ssh/:/var/www/.ssh/
  #   hostname: php82.ivanko.docker
  #   container_name: php82
  #   extra_hosts:
  #     - host.docker.internal:host-gateway
  #   restart: unless-stopped
  #   environment:
  #     - XDEBUG=on
  #     - PHP_IDE_CONFIG=serverName=Docker
  #     - COMPOSER_VERSION=2
  #   networks:
  #     - net

  php83:
    image: ivankodev/php:8.3
    # build: ./images/php/8.3 # UNCOMMENT THIS IF YOU WANT TO BUILD PHP 8.3 FROM SOURCE
    volumes:
      - ./www/:/var/www/
      - ~/.ssh/:/var/www/.ssh/
    hostname: php83.ivanko.docker
    container_name: php83
    extra_hosts:
      - host.docker.internal:host-gateway
    restart: unless-stopped
    environment:
      - XDEBUG=on
      - PHP_IDE_CONFIG=serverName=Docker
      - COMPOSER_VERSION=2
    networks:
      - net

  php84:
    image: ivankodev/php:8.4
    # build: ./images/php/8.4 # UNCOMMENT THIS IF YOU WANT TO BUILD PHP 8.4 FROM SOURCE
    volumes:
      - ./www/:/var/www/
      - ~/.ssh/:/var/www/.ssh/
    hostname: php84.ivanko.docker
    container_name: php84
    extra_hosts:
      - host.docker.internal:host-gateway
    restart: unless-stopped
    environment:
      - XDEBUG=on
      - PHP_IDE_CONFIG=serverName=Docker
      - COMPOSER_VERSION=2
    networks:
      - net

  php85:
    image: ivankodev/php:8.5
    # build: ./images/php/8.5 # UNCOMMENT THIS IF YOU WANT TO BUILD PHP 8.5 FROM SOURCE
    volumes:
      - ./www/:/var/www/
      - ~/.ssh/:/var/www/.ssh/
    hostname: php85.ivanko.docker
    container_name: php85
    extra_hosts:
      - host.docker.internal:host-gateway
    restart: unless-stopped
    environment:
      - XDEBUG=on
      - PHP_IDE_CONFIG=serverName=Docker
      - COMPOSER_VERSION=2
    networks:
      - net
  nginx:
    image: ivankodev/nginx:1.28
    # build: ./images/nginx/1.28 # UNCOMMENT THIS IF YOU WANT TO BUILD NGINX FROM SOURCE
    volumes:
      - ./www/:/var/www/
      - ./conf/nginx/conf.d/:/etc/nginx/conf.d/
      - ./conf/ssl/:/etc/nginx/ssl/
      - ./conf/nginx/snippets/:/etc/nginx/snippets/:ro
    container_name: nginx
    restart: unless-stopped
    ports:
      - "[::]:80:80"
      - "[::]:443:443"
    networks:
      - net

  redis:
    image: redis
    hostname: redis
    container_name: redis
    restart: unless-stopped
    networks:
      - net

  mysql:
    image: mariadb:11.4
    hostname: mysql
    container_name: mysql
    restart: unless-stopped
    command: --max_allowed_packet=64M --optimizer_use_condition_selectivity=1 --optimizer_switch="rowid_filter=off"
    ports:
      - "3306:3306"
    networks:
      - net
    volumes:
      - ./www/mysql/:/var/lib/mysql/
    environment:
      - MARIADB_PASSWORD=admin
      - MARIADB_USER=admin
      - MARIADB_ROOT_PASSWORD=admin

  phpmyadmin:
    image: phpmyadmin
    hostname: phpmyadmin
    container_name: phpmyadmin
    restart: unless-stopped
    ports:
      - "8080:80"
    networks:
      - net
    environment:
      - MYSQL_USER=admin
      - PMA_PASSWORD=admin
      - PMA_HOST=mysql

  elasticsearch:
    image: elasticsearch:7.17.10
    hostname: elasticsearch
    container_name: elasticsearch
    restart: unless-stopped
    ports:
      - "9201:9200"
    command: >
      /bin/sh -c "./bin/elasticsearch-plugin list | grep -q analysis-phonetic || ./bin/elasticsearch-plugin install analysis-phonetic analysis-icu; /usr/local/bin/docker-entrypoint.sh"
    networks:
      - net
    environment:
      - ES_JAVA_OPTS=-Xms2G -Xmx2G
      - discovery.type=single-node

  opensearch:
    image: opensearchproject/opensearch:3
    hostname: opensearch
    container_name: opensearch
    restart: unless-stopped
    ports:
      - "9200:9200"
      - "9300:9300"
    command: >
      /bin/sh -c "./bin/opensearch-plugin list | grep -q analysis-phonetic || ./bin/opensearch-plugin install analysis-phonetic analysis-icu; /usr/share/opensearch/opensearch-docker-entrypoint.sh"
    networks:
      - net
    environment:
      - plugins.security.disabled=true
      - OPENSEARCH_INITIAL_ADMIN_PASSWORD=Opensearch123
      - discovery.type=single-node

  rabbitmq:
    image: rabbitmq:4.1-management
    hostname: rabbitmq
    container_name: rabbitmq
    restart: unless-stopped
    ports:
      - "8082:15672"
    networks:
      - net

networks:
  net:
    name: net
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: "false"
